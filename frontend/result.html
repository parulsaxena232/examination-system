<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Result</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #e0c3fc, #8ec5fc);
      background-size: 400% 400%;
      animation: gradientBG 10s ease infinite;
      min-height: 100vh;
      margin: 0;
      padding-bottom: 60px;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      margin-top: 80px;
      padding: 30px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      max-width: 600px;
      animation: fadeIn 1s ease;
    }

    h2 {
      font-weight: 600;
      margin-bottom: 30px;
      color: #0d6efd;
    }

    p {
      font-size: 18px;
      margin: 10px 0;
    }

    strong {
      color: #333;
    }

    #finalScoreVal {
      font-size: 22px;
      font-weight: bold;
      color: #dc3545;
    }

    .btn-primary {
      margin-top: 20px;
      padding: 10px 25px;
      font-weight: 500;
      border-radius: 50px;
      transition: 0.3s;
    }

    .btn-primary:hover {
      transform: scale(1.05);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="text-center">

<!-- âœ… Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html">Online Exam</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto" id="nav-links"></ul>
      <ul class="navbar-nav">
        <li class="nav-item">
          <span class="navbar-text me-3" id="userNameDisplay"></span>
        </li>
        <li class="nav-item">
          <button class="btn btn-outline-danger" id="logoutBtn" onclick="logout()" style="display: none;">Logout</button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- âœ… Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
  <div id="toast" class="toast align-items-center text-bg-warning border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastMessage">Toast Message</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<!-- âœ… Result Display -->
<div class="container">
  <h2>Your Exam Result</h2>
  <p><strong>Correct Answers:</strong> <span id="scoreVal">-</span></p>
  <p><strong>Wrong Answers:</strong> <span id="wrongVal">-</span></p>
  <p><strong>Total Questions:</strong> <span id="totalVal">-</span></p>
  <p><strong>Percentage:</strong> <span id="percentVal">-</span>%</p>
  <p><strong>Final Score (after -0.25 per wrong):</strong> <span id="finalScoreVal">-</span></p>
  <a href="dashboard.html" class="btn btn-primary">Back to Dashboard</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
// ðŸ”” Show toast
function showToast(message, type = "warning") {
  const toastEl = document.getElementById("toast");
  const toastMsg = document.getElementById("toastMessage");
  toastMsg.innerText = message;
  toastEl.className = `toast align-items-center text-bg-${type} border-0`;
  const bsToast = new bootstrap.Toast(toastEl);
  bsToast.show();
}

// ðŸ”’ Logout
function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}

// ðŸ” Load result
window.onload = function () {
  const token = localStorage.getItem('token');
  const role = localStorage.getItem('role');
  const userName = localStorage.getItem('userName');

  const navLinks = document.getElementById("nav-links");
  const logoutBtn = document.getElementById("logoutBtn");
  const userNameDisplay = document.getElementById("userNameDisplay");

  if (!token) {
    showToast("Unauthorized. Please login.");
    setTimeout(() => window.location.href = "login.html", 2000);
    return;
  }

  logoutBtn.style.display = "inline-block";
  userNameDisplay.innerText = `Welcome, ${userName}`;

  if (role === 'student') {
    navLinks.innerHTML = `
      <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="result.html">Results</a></li>`;
  } else if (role === 'admin') {
    navLinks.innerHTML = `
      <li class="nav-item"><a class="nav-link" href="admin.html">Admin Panel</a></li>
      <li class="nav-item"><a class="nav-link" href="dashboard.html">All Exams</a></li>`;
  }

  const score = parseInt(localStorage.getItem('lastScore'));
  const total = parseInt(localStorage.getItem('lastTotal'));

  if (isNaN(score) || isNaN(total)) {
    showToast("No result data found. Please take an exam first.");
    setTimeout(() => window.location.href = "dashboard.html", 3000);
    return;
  }

  const wrong = total - score;
  const penalty = 0.25 * wrong;
  const finalScore = (score - penalty).toFixed(2);
  const percentage = ((score / total) * 100).toFixed(2);

  document.getElementById('scoreVal').innerText = score;
  document.getElementById('wrongVal').innerText = wrong;
  document.getElementById('totalVal').innerText = total;
  document.getElementById('percentVal').innerText = percentage;
  document.getElementById('finalScoreVal').innerText = finalScore;
}
</script>

</body>
</html>
